<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Check-In - UniConnect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, orientation=portrait">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body {
      background: #ffffff;
      color: #002b5c;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      width: 100%;
      max-width: 450px;
      height: 90vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    .btn {
      background: #FFD500;
      color: #002b5c;
      border: none;
      padding: 20px 40px;
      font-size: 1.8rem;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s;
      font-weight: bold;
    }
    .btn:hover { transform: scale(1.05); background: #ffdf33; }

    .form {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 25px;
      width: 100%;
      animation: fadeIn 0.6s ease;
    }

    .input-container { position: relative; width: 100%; }

    .input {
      padding: 15px;
      font-size: 1.2rem;
      border-radius: 10px;
      border: 2px solid #002b5c70;
      outline: none;
      width: 100%;
      text-align: left;
      color: #002b5c;
    }

    ul.suggestions {
      list-style: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 0 0 10px 10px;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      z-index: 10;
    }

    ul.suggestions li {
      padding: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    ul.suggestions li:hover { background: #e5f0ff; }

    .rating {
      display: flex;
      gap: 15px;
      font-size: 2.5rem;
      cursor: pointer;
      justify-content: center;
    }

    .emoji {
      transition: transform 0.2s;
      filter: grayscale(100%);
    }

    .emoji.selected {
      transform: scale(1.3);
      filter: grayscale(0%);
    }

    .success {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      font-size: 1.4rem;
      gap: 15px;
      color: #002b5c;
    }

    .confetti {
      font-size: 4rem;
      animation: pop 0.8s ease-out forwards;
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 90, 200, 0.1);
      backdrop-filter: blur(3px);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
    }

    .spinner {
      border: 6px solid #cce0ff;
      border-top: 6px solid #0056d6;
      border-radius: 50%;
      width: 70px;
      height: 70px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pop {
      from { opacity: 0; transform: scale(0); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="container" id="container">

    <button id="checkinBtn" class="btn">Fazer Check-In</button>

    <!-- Etapa 1 -->
    <div id="form" class="form">
      <input type="text" id="name" class="input" placeholder="Qual seu nome?">

      <div class="input-container">
        <input type="text" id="course" class="input" placeholder="Qual seu curso?">
        <ul id="courseList" class="suggestions"></ul>
      </div>

      <h3>Como est√° o evento?</h3>
      <div class="rating" id="ratingEvent">
        <span class="emoji">üòê</span>
        <span class="emoji">üôÇ</span>
        <span class="emoji">üòÑ</span>
        <span class="emoji">ü§©</span>
      </div>

      <button id="nextBtn" class="btn">Pr√≥ximo</button>
    </div>

    <!-- Etapa 2 -->
    <div id="form2" class="form">
      <h3>Quanto voc√™ gostou da nossa apresenta√ß√£o?</h3>
      <div class="rating" id="ratingPresentation">
        <span class="emoji">üòê</span>
        <span class="emoji">üôÇ</span>
        <span class="emoji">üòÑ</span>
        <span class="emoji">ü§©</span>
      </div>

      <button id="finalizeBtn" class="btn">Finalizar Check-In</button>
    </div>

    <!-- Sucesso -->
    <div id="success" class="success">
      <div class="confetti">üéâ</div>
      <p>Check-In realizado com sucesso!</p>
    </div>

  </div>

  <!-- Loading Azul -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p style="color:#002b5c; font-size:1.2rem; font-weight:600;">Enviando dados...</p>
  </div>

  <script>
    const checkinBtn = document.getElementById("checkinBtn");
    const form = document.getElementById("form");
    const form2 = document.getElementById("form2");
    const success = document.getElementById("success");
    const courseInput = document.getElementById("course");
    const courseList = document.getElementById("courseList");
    const nextBtn = document.getElementById("nextBtn");
    const finalizeBtn = document.getElementById("finalizeBtn");
    const loadingOverlay = document.getElementById("loadingOverlay");

    const cursos = [
      "Administra√ß√£o", "Arquitetura e Urbanismo", "Biomedicina", "Ci√™ncia da Computa√ß√£o",
      "Ci√™ncias Cont√°beis", "Direito", "Educa√ß√£o F√≠sica", "Enfermagem", "Engenharia Civil",
      "Engenharia de Produ√ß√£o", "Engenharia El√©trica", "Engenharia Mec√¢nica", "Farm√°cia",
      "Fisioterapia", "Jornalismo", "Medicina Veterin√°ria", "Nutri√ß√£o", "Pedagogia",
      "Psicologia", "Publicidade e Propaganda", "Rela√ß√µes Internacionais",
      "Servi√ßo Social", "Sistemas de Informa√ß√£o"
    ];

    const connection = new signalR.HubConnectionBuilder().withUrl("/notifyHub").build();
    connection.start().catch(err => console.error(err.toString()));

    checkinBtn.addEventListener("click", () => {
      gsap.to(checkinBtn, { scale: 0, opacity: 0, duration: 0.5, onComplete: () => {
        checkinBtn.style.display = "none";
        form.style.display = "flex";
        gsap.fromTo(form, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.6 });
      }});
    });

    document.querySelectorAll('.emoji').forEach(emoji => {
      emoji.addEventListener('click', () => {
        const group = emoji.parentElement;
        group.querySelectorAll('.emoji').forEach(e => e.classList.remove('selected'));
        emoji.classList.add('selected');
      });
    });

    courseInput.addEventListener("input", () => {
      const value = courseInput.value.toLowerCase();
      courseList.innerHTML = "";
      const filtrados = cursos.filter(c => c.toLowerCase().includes(value));
      if (!filtrados.length) { courseList.style.display = "none"; return; }
      filtrados.forEach(curso => {
        const li = document.createElement("li");
        li.textContent = curso;
        li.onclick = () => {
          courseInput.value = curso;
          courseList.style.display = "none";
        };
        courseList.appendChild(li);
      });
      courseList.style.display = "block";
    });

    nextBtn.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const course = document.getElementById("course").value.trim();
      if (!name || !course) {
        alert("Por favor, preencha seu nome e curso.");
        return;
      }
      gsap.to(form, { opacity: 0, scale: 0.8, duration: 0.5, onComplete: () => {
        form.style.display = "none";
        form2.style.display = "flex";
        gsap.fromTo(form2, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.6 });
      }});
    });

    finalizeBtn.addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const course = document.getElementById("course").value.trim();
      const ratingEvent = document.querySelector('#ratingEvent .emoji.selected')?.textContent || "üôÇ";
      const ratingPresentation = document.querySelector('#ratingPresentation .emoji.selected')?.textContent || "üôÇ";

      loadingOverlay.style.display = "flex"; // Mostra o loading azul

      try {
        await connection.invoke("SendMessage", "CheckIn", `${name} (${course}) fez check-in ${ratingEvent} ‚Äî Apresenta√ß√£o: ${ratingPresentation}`);
      } catch (err) {
        console.error("Erro SignalR:", err);
      }

      // Simula carregamento e reinicia
      setTimeout(() => {
        loadingOverlay.style.display = "none";
        location.reload(); // Refresh suave (reinicia tudo)
      }, 2000);
    });
  </script>
</body>
</html>
